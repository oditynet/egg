{% extends "base.html" %}

{% block title %}–ú–æ–∏ –∑–∞–∫–∞–∑—ã - –Ø–π—Ü–æ{% endblock %}

{% block content %}
<div class="user-orders">
    <h2 class="section__title">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
    
    {% if orders %}
    <div class="orders-list">
        {% for order in orders %}
        <div class="order-item">
            <div class="order-item__header">
                <div><strong>–ó–∞–∫–∞–∑ #{{ order.order_number }}</strong></div>
                <div>{{ order.created_at[:16] }}</div>
            </div>
            
            <div class="order-item__products">
                {% set order_products = order.products|from_json %}
                {% for product in order_products %}
                    <div class="order-product">
                        <span class="order-product__name">{{ product.name }}</span>
                        <span class="order-product__details">{{ product.quantity }} —à—Ç. √ó {{ product.price }} —Ä—É–±. = {{ product.quantity * product.price }} —Ä—É–±.</span>
                    </div>
                {% endfor %}
            </div>
            
            <div class="order-item__status">
                <span class="status-badge 
                    {% if order.status == 'payment' %}status-badge--payment
                    {% elif order.status == 'shipping' %}status-badge--shipping
                    {% elif order.status == 'delivery' %}status-badge--delivery
                    {% elif order.status == 'received' %}status-badge--received
                    {% endif %}">
                    
                    {% if order.status == 'payment' %}–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
                    {% elif order.status == 'shipping' %}–í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                    {% elif order.status == 'delivery' %}–ü–µ—Ä–µ–¥–∞–Ω –≤ –¥–æ—Å—Ç–∞–≤–∫—É
                    {% elif order.status == 'received' %}–ü–æ–ª—É—á–µ–Ω
                    {% else %}{{ order.status }}{% endif %}
                </span>
                
                <span class="order-total">–û–±—â–∞—è —Å—É–º–º–∞: <strong>{{ order.total_price }} —Ä—É–±.</strong></span>
            </div>
            
            <div class="order-address">
                <strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ order.address }}
            </div>
            
            {% if order.status == 'delivery' and order.verification_code %}
            <div class="delivery-verification">
                <div class="verification-info">
                    <h4>‚úÖ –í–∞—à –∑–∞–∫–∞–∑ –ø–µ—Ä–µ–¥–∞–Ω –≤ –¥–æ—Å—Ç–∞–≤–∫—É</h4>
                    <p><strong>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:</strong> 
                       <span class="verification-code">{{ order.verification_code }}</span>
                    </p>
                    <p class="verification-help">–°–æ–æ–±—â–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –ø—Ä–æ–¥–∞–≤—Ü—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞</p>
                </div>
            </div>
            {% endif %}
            
            {% if order.updated_at != order.created_at %}
            <div class="order-updated">
                <small>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ order.updated_at[:16] }}</small>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-orders">
        <div class="empty-orders__icon">üì¶</div>
        <h3 class="empty-orders__title">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</h3>
        <p class="empty-orders__text">–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∫—É–ø–∫–∏ –∏ –≤–∞—à–∏ –∑–∞–∫–∞–∑—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
        <a href="{{ url_for('index') }}" class="btn btn--primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
    </div>
    {% endif %}
</div>

<style>
.order-item {
    background-color: white;
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
}

.order-item__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f8f9fa;
}

.order-item__products {
    margin-bottom: 15px;
}

.order-product {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.order-product:last-child {
    border-bottom: none;
}

.order-product__name {
    flex: 2;
    font-weight: 500;
}

.order-product__details {
    flex: 1;
    text-align: right;
    color: var(--accent-color);
}

.order-item__status {
    display: flex;
    align-items: center;
    margin: 20px 0;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: var(--border-radius);
}

.order-total {
    margin-left: auto;
    font-size: 16px;
}

.order-address {
    margin: 15px 0;
    padding: 12px;
    background-color: var(--secondary-color);
    border-radius: var(--border-radius);
    font-size: 14px;
}

.order-updated {
    margin-top: 5px;
    text-align: right;
    color: #888;
    font-size: 12px;
}

.delivery-verification {
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(135deg, var(--secondary-color), #e6ffe6);
    border-radius: var(--border-radius);
    border-left: 4px solid var(--success-color);
}

.verification-info h4 {
    color: var(--success-color);
    margin-bottom: 10px;
}

.verification-code {
    font-family: monospace;
    font-size: 18px;
    font-weight: bold;
    color: #155724;
    background-color: #d4edda;
    padding: 5px 10px;
    border-radius: 4px;
}

.verification-help {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
}

.status-badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 500;
    margin-right: 15px;
}

.status-badge--payment {
    background-color: var(--warning-color);
    color: #856404;
}

.status-badge--shipping {
    background-color: var(--secondary-color);
    color: #004085;
}

.status-badge--delivery {
    background-color: #fff3cd;
    color: #856404;
}

.status-badge--received {
    background-color: var(--success-color);
    color: #155724;
}

.empty-orders {
    text-align: center;
    padding: 60px 20px;
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.empty-orders__icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.empty-orders__title {
    color: var(--accent-color);
    margin-bottom: 10px;
    font-size: 24px;
}

.empty-orders__text {
    color: var(--dark-color);
    margin-bottom: 30px;
    font-size: 16px;
}

@media (max-width: 768px) {
    .order-item__header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
    
    .order-item__status {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
    
    .order-total {
        margin-left: 0;
    }
    
    .order-product {
        flex-direction: column;
        gap: 5px;
    }
    
    .order-product__details {
        text-align: left;
    }
    
    .empty-orders {
        padding: 40px 15px;
    }
    
    .empty-orders__icon {
        font-size: 48px;
    }
    
    .empty-orders__title {
        font-size: 20px;
    }
}
</style>
{% endblock %}


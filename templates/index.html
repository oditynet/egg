{% extends "base.html" %}

{% block content %}
<section class="section">
    <div class="filters-section">
        <h2 class="section__title">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>
        
        <div class="filters-container">
            <div class="filters-sidebar">
                <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
                
                <form class="filters-form" method="GET" action="{{ url_for('index') }}">
                    <div class="filter-group">
                        <label>–¶–µ–Ω–∞:</label>
                        <div class="price-filters">
                            <input type="number" name="min_price" placeholder="–û—Ç" value="{{ min_price if min_price }}" class="form-input" min="0">
                            <span>-</span>
                            <input type="number" name="max_price" placeholder="–î–æ" value="{{ max_price if max_price }}" class="form-input" min="0">
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                        <select name="sort_by" class="form-select">
                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                            <option value="price" {% if sort_by == 'price' %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ</option>
                            <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
                            <option value="reviews" {% if sort_by == 'reviews' %}selected{% endif %}>–ü–æ –æ—Ç–∑—ã–≤–∞–º</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>–ü–æ—Ä—è–¥–æ–∫:</label>
                        <select name="sort_order" class="form-select">
                            <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                            <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                        </select>
                    </div>
                    
                    <input type="hidden" name="search" value="{{ search_query }}">
                    <button type="submit" class="btn btn--secondary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                    <a href="{{ url_for('index') }}" class="btn btn--secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                </form>
            </div>
            
            <div class="products-main">
                {% if search_query %}
                <div class="search-results-info">
                    <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É: <strong>"{{ search_query }}"</strong></p>
                    <p>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products|length }}</p>
                </div>
                {% endif %}
                
                {% if products %}
                <div class="products-grid">
                    {% for product in products %}
                    <div class="product-card">
                        <img src="{{ product.images.split('\n')[0] if product.images else url_for('static', filename='images/placeholder.jpg') }}" 
                             alt="{{ product.name }}" class="product-card__image">
                        <div class="product-card__content">
                            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="product-card__title">{{ product.name }}</a>
                            
                            <div class="product-rating">
                                <div class="stars">
                                    {% for i in range(5) %}
                                        {% if i < product.rating|int %}
                                            <span class="star filled">‚òÖ</span>
                                        {% else %}
                                            <span class="star">‚òÖ</span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <span class="rating-value">({{ product.rating|round(1) }})</span>
                                <span class="reviews-count">{{ product.reviews_count }} –æ—Ç–∑—ã–≤–æ–≤</span>
                            </div>
                            
                            <div class="product-card__price">{{ product.price }} —Ä—É–±.</div>
                            <button class="product-card__btn" onclick="addToCart({{ product.id }})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-products">
                    <div class="empty-products__icon">üîç</div>
                    <h3 class="empty-products__title">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p class="empty-products__text">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                    <a href="{{ url_for('index') }}" class="btn btn--primary">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<style>
.search-results-info {
    background: white;
    padding: 15px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 20px;
}

.search-results-info p {
    margin: 5px 0;
}

.empty-products {
    text-align: center;
    padding: 60px 20px;
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.empty-products__icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.empty-products__title {
    color: var(--accent-color);
    margin-bottom: 10px;
    font-size: 24px;
}

.empty-products__text {
    color: var(--dark-color);
    margin-bottom: 30px;
    font-size: 16px;
}

.filters-form .btn {
    margin-top: 10px;
    margin-right: 10px;
}

@media (max-width: 768px) {
    .filters-container {
        grid-template-columns: 1fr;
    }
    
    .filters-sidebar {
        order: 2;
    }
    
    .products-main {
        order: 1;
    }
    
    .price-filters {
        flex-direction: column;
        gap: 5px;
    }
    
    .price-filters input {
        width: 100%;
    }
    
    .filters-form .btn {
        width: 100%;
        margin: 5px 0;
    }
}
</style>
{% endblock %}